# 账户图表粘贴导入格式调整总结

## 调整内容

根据用户要求，将粘贴导入功能的格式从：
**账户代码,账户名称,账户类型,余额,描述,父账户**

调整为：
**账户代码,账户类型,账户名称,财务报表分类,余额,描述,父账户**

## 主要变更

### 1. 数据模型更新

#### `lib/data.ts`
- 在 `Account` 接口中新增 `financialStatement?: string` 字段
- 用于存储账户所属的财务报表分类（如：资产负债表、利润表等）

### 2. 导入对话框更新

#### `components/modules/import-dialog.tsx`
- 更新 `ParsedAccount` 接口，新增 `financialStatement` 字段
- 修改解析逻辑，调整字段顺序：
  - 旧格式：`[code, name, type, balanceStr, description, parent]`
  - 新格式：`[code, type, name, financialStatement, balanceStr, description, parent]`
- 更新字段验证逻辑，要求至少4个字段（代码、类型、名称、财务报表分类）
- 更新UI显示，在预览中显示财务报表分类信息
- 更新占位符文本和说明文档

### 3. 账户图表组件更新

#### `components/modules/account-chart.tsx`
- 更新 `AccountChartProps` 接口中的 `onAccountsImport` 回调类型
- 更新 `handleImport` 函数参数类型，包含 `financialStatement` 字段

## 新格式说明

### 字段顺序
1. **账户代码** - 账户的唯一标识符
2. **账户类型** - Asset/Liability/Equity/Revenue/Expense
3. **账户名称** - 账户的显示名称
4. **财务报表分类** - 所属的财务报表（如：资产负债表、利润表等）
5. **余额** - 账户当前余额
6. **描述** - 账户的详细描述（可选）
7. **父账户** - 父级账户代码（可选）

### 示例数据
```
1001,Asset,现金,资产负债表,15000,公司现金账户,
1002,Asset,银行存款,资产负债表,50000,银行活期存款,
2001,Liability,应付账款,资产负债表,25000,供应商欠款,
3001,Equity,实收资本,资产负债表,100000,股东投资,
4001,Revenue,销售收入,利润表,75000,主营业务收入,
5001,Expense,管理费用,利润表,15000,日常管理费用
```

## 验证规则

### 必需字段验证
- 账户代码：不能为空，长度不超过10个字符
- 账户类型：必须是 Asset/Liability/Equity/Revenue/Expense 之一
- 账户名称：不能为空，长度不超过100个字符
- 财务报表分类：不能为空

### 可选字段验证
- 余额：必须是有效数字
- 描述：无特殊限制
- 父账户：无特殊限制

## 测试验证

创建了测试脚本 `scripts/test-new-format.js` 来验证新格式的解析功能：
- 测试数据包含8个不同账户类型的示例
- 验证字段解析和验证逻辑
- 确认财务报表分类字段正确显示

## 向后兼容性

由于新增了 `financialStatement` 字段，建议：
1. 在导入现有数据时，可以为该字段设置默认值
2. 在显示账户信息时，如果该字段为空，可以隐藏相关显示
3. 在导出功能中，可以包含该字段以保持数据完整性

## 使用说明

1. 在账户图表页面点击"导入"按钮
2. 选择数据格式（CSV/TSV/Excel）
3. 粘贴按新格式排列的数据
4. 系统会自动解析并验证数据
5. 预览有效和无效的账户
6. 确认导入有效的账户

## 技术实现

- 使用 TypeScript 确保类型安全
- 使用 Zod 进行数据验证
- 实时解析和预览功能
- 错误提示和统计信息
- 支持多种数据格式（CSV、TSV、Excel） 