# 收支分类管理功能

## 概述

收支分类管理功能允许用户创建、编辑、删除和管理收入和支出分类，用于对交易进行分类和生成报表分析。

## 功能特性

### 1. 分类管理
- **创建分类**: 添加新的收入或支出分类
- **编辑分类**: 修改现有分类的信息
- **删除分类**: 永久删除不需要的分类
- **启用/禁用**: 通过开关控制分类的启用状态

### 2. 分类属性
- **分类代码**: 唯一标识符，用于快速识别分类
- **分类名称**: 分类的显示名称
- **分类类型**: 收入(Income) 或 支出(Expense)
- **分类描述**: 详细的分类说明
- **启用状态**: 控制分类是否可用
- **创建信息**: 记录创建者和创建时间

### 3. 搜索和筛选
- **全文搜索**: 按代码、名称或描述搜索
- **类型筛选**: 按收入或支出类型筛选
- **状态筛选**: 按启用或禁用状态筛选
- **组合筛选**: 支持多种筛选条件组合

### 4. 统计功能
- **总分类数**: 显示所有分类的数量
- **收入分类数**: 显示收入分类的数量
- **支出分类数**: 显示支出分类的数量
- **启用分类数**: 显示启用状态的分类数量
- **禁用分类数**: 显示禁用状态的分类数量

## 数据模型

### Category 接口
```typescript
interface Category {
  id?: string // Firestore document ID
  code: string // 分类代码
  name: string // 分类名称
  type: "Income" | "Expense" // 收入或支出分类
  description?: string // 分类描述
  parentId?: string // 父分类ID，用于层级结构
  isActive: boolean // 是否启用
  createdAt: string // 创建时间
  updatedAt: string // 更新时间
  createdByUid: string // 创建者UID
}
```

## 权限控制

### 访问权限
- **Level 2 (VICE_PRESIDENT) 及以上**: 可以创建、编辑、删除分类
- **Level 3 (ASSISTANT_VICE_PRESIDENT) 及以上**: 可以查看分类列表
- **所有用户**: 可以查看启用的分类

### 操作权限
- **添加分类**: 需要 Level 2 权限
- **编辑分类**: 需要 Level 2 权限
- **删除分类**: 需要 Level 2 权限
- **切换状态**: 需要 Level 2 权限
- **查看统计**: 所有用户都可以查看

## 使用指南

### 1. 添加新分类
1. 在账户设置页面，点击"收支分类"标签
2. 点击"添加分类"按钮
3. 填写分类信息：
   - 分类代码（必填，唯一）
   - 分类名称（必填）
   - 分类类型（收入或支出）
   - 分类描述（可选）
   - 启用状态
4. 点击"添加分类"保存

### 2. 编辑分类
1. 在分类列表中找到要编辑的分类
2. 点击编辑按钮（铅笔图标）
3. 修改分类信息
4. 点击"保存更改"

### 3. 删除分类
1. 在分类列表中找到要删除的分类
2. 点击删除按钮（垃圾桶图标）
3. 确认删除操作

### 4. 启用/禁用分类
1. 在分类列表中找到目标分类
2. 切换状态开关
3. 系统会自动保存状态变更

### 5. 搜索和筛选
1. 使用搜索框输入关键词
2. 选择分类类型筛选器
3. 选择状态筛选器
4. 查看筛选结果

## 最佳实践

### 1. 分类代码命名
- 使用有意义的代码，如 "EXP001" 表示支出分类
- 保持代码简洁，便于记忆
- 避免使用特殊字符

### 2. 分类组织
- 按业务功能组织分类
- 使用描述性的名称
- 定期清理不使用的分类

### 3. 权限管理
- 限制分类管理权限给必要的人员
- 定期审查分类使用情况
- 记录分类变更历史

## 技术实现

### 1. 前端组件
- `CategoryManagement`: 主要的分类管理组件
- 集成在 `AccountSettings` 组件中
- 使用 React hooks 管理状态

### 2. 后端服务
- Firebase Firestore 存储分类数据
- 实时数据同步
- 权限验证和访问控制

### 3. 数据验证
- 分类代码唯一性检查
- 必填字段验证
- 数据类型验证

## 错误处理

### 1. 常见错误
- **代码重复**: 分类代码已存在
- **权限不足**: 用户没有操作权限
- **网络错误**: 连接问题导致操作失败
- **数据验证失败**: 输入数据不符合要求

### 2. 错误提示
- 友好的错误消息
- 具体的错误原因
- 建议的解决方案

## 测试

### 1. 功能测试
运行测试脚本验证CRUD操作：
```bash
node scripts/test-category-management.js
```

### 2. 测试覆盖
- 创建分类测试
- 查询分类测试
- 更新分类测试
- 删除分类测试
- 权限验证测试
- 搜索筛选测试

## 未来改进

### 1. 功能增强
- 分类层级结构支持
- 批量操作功能
- 分类导入/导出
- 分类使用统计

### 2. 用户体验
- 拖拽排序功能
- 批量编辑功能
- 高级搜索选项
- 分类模板功能

### 3. 集成功能
- 与交易模块集成
- 与报表模块集成
- 与预算模块集成
- 与审计模块集成 